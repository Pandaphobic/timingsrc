<!DOCTYPE html>

<html>
<head>
    <!-- requirejs config -->
    <script>
        var require = {
          baseUrl : '../',
        };
    </script>
    <script type="text/javascript" src="../../docs/lib/require.js"></script>
    <script type="text/javascript">
        var to, w, w2;

        function console_handler(eArg, eInfo) {
            const to = eInfo.src;
            let args = [`onchange ${to._name}`];
            if (eArg.vector) {
                args.push(eArg.vector);
            }
            if (eArg.range) {
                args.push(eArg.range);
            }
            console.log.apply(null, args);
        }

        function setup_timingobject(key, name, to) {


            // html
            const html = `
            <h3>${name}</h3>
            <p >
            Pos : <span style="font-weight:bold;" id="pos_${key}" ></span>
            </p>
            <p>
            Range : <span id="range_${key}"></span>
            </p>
            <button id="play_${key}">Play</button>
            <button id="pause_${key}">Pause</button>
            <button id="reset_${key}">Reset</button>
            <button id="back_${key}">Back</button>
            `

            const list_node = document.getElementById("list");
            const to_node = document.createElement("div");
            to_node.innerHTML = html;
            list_node.appendChild(to_node);

            // timing object

            to._name = name;

            to.on("change", console_handler);

            // Hook up buttons UI
            document.getElementById(`play_${key}`).onclick = function () {
                to.update({velocity:1.0});
            };
            document.getElementById(`pause_${key}`).onclick = function () {
                to.update({velocity:0.0});
            };
            document.getElementById(`reset_${key}`).onclick = function () {
                to.update({position: 0.0, velocity:0.0});
            };
            document.getElementById(`back_${key}`).onclick = function () {
                to.update({velocity:-1.0});
            };

            const range_elem = document.getElementById(`range_${key}`);
            to.on("change", function(eArg) {
                if (eArg.range) {
                    let [low, high] = eArg.range;
                    range_elem.innerHTML = `[${low},${high}]`;
                }
            })

            const pos_elem = document.getElementById(`pos_${key}`);
            to.on("timeupdate", function () {
                pos_elem.innerHTML = to.query().position.toFixed(2);
            });
        };

        require(['test/main'], function (timingsrc) {

            function run() {

                to = new timingsrc.TimingObject({range:[0,10]});
                setup_timingobject(0, "Source", to);

                w = new timingsrc.SkewConverter(to, 2.0);
                setup_timingobject(1, "Skew", w);
                //w = new timingsrc.DelayConverter(to, 1.0);
                //w = new timingsrc.ScaleConverter(to, 2);
                //w = new timingsrc.LoopConverter(to, [0, 10]);
                //w = new timingsrc.RangeConverter(to, [2,8]);
                //w = new timingsrc.TimeShiftConverter(to, -1.0);
                //w = new timingsrc.LocalConverter(to);

                //w = new timingsrc.DerivativeConverter(to);


                //w = setup_converter1(to);
                /*
                setTimeout(function() {
                w2 = setup_converter2(to);
                }, 4000);
                */
            };

            if (document.readyState === "complete") {
                run();}
            else {
                window.onload = run;
            }
        });
    </script>
    </head>
<body>
    <h1>Test Timing Converters</h1>
    <div id=list></div>
</body>
</html>
